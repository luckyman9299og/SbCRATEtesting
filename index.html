<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crate Unbox Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: white;
      overflow: hidden;
    }
    h1 { margin: 20px; }
    .crate-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }
    .crate-buttons button {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #222;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    .crate-buttons button:hover {
      transform: scale(1.05);
      background: #333;
    }
    .crate-buttons img {
      width: 30px;
      height: 30px;
      object-fit: contain;
    }
    #unboxBtn, #multiUnboxBtn {
      margin: 10px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    #unboxBtn:hover:enabled, #multiUnboxBtn:hover:enabled { transform: scale(1.05); }
    #unboxBtn:disabled, #multiUnboxBtn:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
    }
    #multiInput {
      width: 80px;
      padding: 6px;
      border-radius: 6px;
      border: none;
      text-align: center;
    }
    #result {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
    }
    .separator {
      border-top: 2px solid #444;
      margin: 15px auto;
      width: 60%;
    }
    .confetti {
      position: fixed;
      bottom: 0;
      opacity: 0.9;
      animation: pop-fall 3s ease-out forwards;
    }
    @keyframes pop-fall {
      0%   { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
      20%  { transform: translateY(-150px) scale(1.2) rotate(90deg); }
      50%  { transform: translateY(-250px) scale(1) rotate(180deg); }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    #popupOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #popupBox {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      text-align: left;
    }
    #popupBox h2 { margin-top: 0; }
    #closePopup {
      background: #444;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      float: right;
    }
    #closePopup:hover { background: #666; }
  </style>
</head>
<body>
  <h1>Crate Unbox Simulator</h1>

  <div class="crate-buttons">
    <button data-crate="standard"><img src="standardcrate.png">Standard Crate</button>
    <button data-crate="megarock"><img src="megarockcrate.png">Megarock Crate</button>
    <button data-crate="bob"><img src="bobcrate.png">Bob Crate</button>
    <button data-crate="barzil"><img src="barzilcrate.png">Barzil Crate</button>
    <button data-crate="overkill"><img src="overkillcrate.png">Overkill Crate</button>
    <button data-crate="jack"><img src="jackscrate.png">Jack’s Crate</button>
    <button data-crate="guides"><img src="guidescrate.png">Guide’s Crate</button>
    <button data-crate="alchemist"><img src="alchemistcrate.png">Alchemist Crate</button>
  </div>

  <div>
    <button id="unboxBtn" disabled>Unbox</button>
    <div class="separator"></div>
    <input type="number" id="multiInput" min="1" placeholder="Amount" style="display:none;">
    <button id="multiUnboxBtn" style="display:none;">Unbox Amount</button>
  </div>

  <div id="result"></div>

  <div id="popupOverlay">
    <div id="popupBox">
      <button id="closePopup">Close</button>
      <h2>Unbox Log</h2>
      <div id="logContent"></div>
    </div>
  </div>

  <audio id="mythicSound" src="mythic.mp3"></audio>
  <audio id="reludeSound" src="relude.mp3"></audio>

  <script>
  // Ensure code runs AFTER page loads
  window.addEventListener("DOMContentLoaded", () => {

    let currentCrate = null;
    let cooldownActive = false;
    let legendaryCounter = 0;
    let mythicCounter = 0;

    const rarityOrder = { mythic: 1, legendary: 2, epic: 3, rare: 4, uncommon: 5 };

    // --- your crates object here ---
    const crates = { /* ... keep your existing crate data ... */ };

    // ✅ Event-based crate selection (no inline onclick)
    document.querySelectorAll(".crate-buttons button").forEach(btn => {
      btn.addEventListener("click", () => {
        const crate = btn.getAttribute("data-crate");
        currentCrate = crate;
        legendaryCounter = 0;
        mythicCounter = 0;
        document.getElementById("unboxBtn").disabled = false;
        document.getElementById("multiInput").style.display = "inline-block";
        document.getElementById("multiUnboxBtn").style.display = "inline-block";
        document.getElementById("result").innerHTML = `Selected <b>${crate} crate</b>. Press Unbox!`;
      });
    });

    function randomChoice(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function getRandomItem(crateData) {
      let roll = Math.random() * 100;
      let cumulative = 0;
      if (crateData.uncommons) {
        cumulative += crateData.uncommons.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.uncommons.items), rarity: crateData.uncommons.color, type: "uncommon" };
      }
      if (crateData.rares) {
        cumulative += crateData.rares.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.rares.items), rarity: crateData.rares.color, type: "rare" };
      }
      if (crateData.epics) {
        cumulative += crateData.epics.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.epics.items), rarity: crateData.epics.color, type: "epic" };
      }
      if (crateData.legendary) {
        cumulative += crateData.legendary.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.legendary.items), rarity: crateData.legendary.color, type: "legendary" };
      }
      if (crateData.mythic) {
        return { item: randomChoice(crateData.mythic.items), rarity: crateData.mythic.color, type: "mythic" };
      }
      return { item: "Unknown", rarity: "", type: "none" };
    }

    function unbox() {
      if (!currentCrate || cooldownActive) return;
      legendaryCounter++;
      mythicCounter++;
      const result = getRandomItem(crates[currentCrate]);

      if (result.type === "legendary") {
        document.getElementById("result").innerHTML = `You rolled a legendary after ${legendaryCounter} rolls: ${result.rarity} <b>${result.item}</b>`;
        legendaryCounter = 0;
        triggerCooldown(500);
      } else if (result.type === "mythic") {
        document.getElementById("result").innerHTML = `You rolled a mythic after ${mythicCounter} rolls: ${result.rarity} <b>${result.item}</b>`;
        mythicCounter = 0;
        triggerCooldown(5000);
        const audio = currentCrate === "guides" ? "reludeSound" : "mythicSound";
        document.getElementById(audio).play();
        launchConfetti();
      } else {
        document.getElementById("result").innerHTML = `You unboxed: ${result.rarity} <b>${result.item}</b>`;
      }
    }

    function triggerCooldown(ms) {
      cooldownActive = true;
      const btn = document.getElementById("unboxBtn");
      btn.disabled = true;
      setTimeout(() => {
        cooldownActive = false;
        btn.disabled = false;
      }, ms);
    }

    function launchConfetti() {
      for (let i = 0; i < 40; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = `${Math.random() * 100}vw`;
        confetti.style.backgroundColor = `hsl(${Math.random() * 360},100%,60%)`;
        confetti.style.width = confetti.style.height = `${Math.random() * 10 + 5}px`;
        confetti.style.animationDuration = `${2 + Math.random() * 2}s`;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }
    }

    document.getElementById("unboxBtn").addEventListener("click", unbox);
    document.getElementById("closePopup").addEventListener("click", () => {
      document.getElementById("popupOverlay").style.display = "none";
    });

  }); // DOMContentLoaded
  </script>
</body>
</html>
