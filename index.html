<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crate Unbox Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: white;
      overflow-x: hidden;
      overflow-y: hidden;
    }
    h1 {
      margin: 20px;
    }
    .crate-buttons {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 20px;
    }
    .crate-buttons button {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #222;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    .crate-buttons button:hover {
      transform: scale(1.05);
      background: #333;
    }
    .crate-buttons img {
      width: 30px;
      height: 30px;
      object-fit: contain;
    }
    #unboxBtn, #multiUnboxBtn {
      margin: 10px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.2s;
    }
    #unboxBtn:hover:enabled, #multiUnboxBtn:hover:enabled {
      transform: scale(1.05);
    }
    #unboxBtn:disabled, #multiUnboxBtn:disabled {
      background: #444;
      color: #aaa;
      cursor: not-allowed;
    }
    #multiInput {
      width: 80px;
      padding: 6px;
      border-radius: 6px;
      border: none;
      text-align: center;
    }
    #result {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
    }

    .separator {
      border-top: 2px solid #444;
      margin: 15px auto;
      width: 60%;
    }

    .confetti {
      position: fixed;
      bottom: 0;
      opacity: 0.9;
      animation: pop-fall 3s ease-out forwards;
    }
    @keyframes pop-fall {
      0%   { transform: translateY(0) scale(1) rotate(0deg); opacity: 1; }
      20%  { transform: translateY(-150px) scale(1.2) rotate(90deg); }
      50%  { transform: translateY(-250px) scale(1) rotate(180deg); }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    #popupOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #popupBox {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      text-align: left;
    }
    #popupBox h2 { margin-top: 0; }
    #closePopup {
      background: #444;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      float: right;
    }
    #closePopup:hover { background: #666; }
  </style>
</head>
<body>
  <h1>Crate Unbox Simulator</h1>

  <div class="crate-buttons">
    <button onclick="selectCrate('standard')">
      <img src="standardcrate.png" alt="Standard Crate"> Standard Crate
    </button>
    <button onclick="selectCrate('megarock')">
      <img src="megarockcrate.png" alt="Megarock Crate"> Megarock Crate
    </button>
    <button onclick="selectCrate('bob')">
      <img src="bobcrate.png" alt="Bob Crate"> Bob Crate
    </button>
    <button onclick="selectCrate('barzil')">
      <img src="barzilcrate.png" alt="Barzil Crate"> Barzil Crate
    </button>
    <button onclick="selectCrate('overkill')">
      <img src="overkillcrate.png" alt="Overkill Crate"> Overkill Crate
    </button>
  </div>

  <div>
    <button id="unboxBtn" onclick="unbox()" disabled>Unbox</button>
    <div class="separator"></div>
    <input type="number" id="multiInput" min="1" placeholder="Amount" style="display:none;">
    <button id="multiUnboxBtn" onclick="multiUnbox()" style="display:none;">Unbox Amount</button>
  </div>

  <div id="result"></div>

  <!-- Popup -->
  <div id="popupOverlay">
    <div id="popupBox">
      <button id="closePopup" onclick="closePopup()">Close</button>
      <h2>Unbox Log</h2>
      <div id="logContent"></div>
    </div>
  </div>

  <audio id="mythicSound" src="mythic.mp3"></audio>

  <script>
    let currentCrate = null;
    let cooldownActive = false;
    let rollCounter = 0;

    const rarityOrder = { mythic: 1, legendary: 2, epic: 3, rare: 4, uncommon: 5 };

    const crates = {
      standard: {
        uncommons: { chance: 79, items: ["slime","water","leaves","ink","forcefield","explosion","cartoony water","butterflies","blue explosion","birds"], color: "游릭" },
        rares: { chance: 18, items: ["pixilated lightning","plasma blast","painted","fireworks"], color: "游댯" },
        epics: { chance: 2.5, items: ["psychic","poisonous"], color: "游릮" },
        legendary: { chance: 0.5, items: ["lightning"], color: "游리" }
      },
      megarock: {
        uncommons: { chance: 70, items: ["Stop","Rocks","Noob","Moyai","Lucky","Fish","Duckie","Blossom"], color: "游릭" },
        rares: { chance: 26, items: ["Robux","Pixelated explosion","Music","Gold","Glitched"], color: "游댯" },
        epics: { chance: 3.3, items: ["Windy","Rgb","Smoked"], color: "游릮" },
        legendary: { chance: 0.6, items: ["Glass","Slashes"], color: "游리" },
        mythic: { chance: 0.1, items: ["Energized"], color: "游댮" }
      },
      bob: {
        uncommons: { chance: 60, items: ["Snow","Retro","Heart","Sandy","Evil","Bread","Binary"], color: "游릭" },
        rares: { chance: 34, items: ["Light","Pixel Pubbles","Rays","Eye","Iceshards"], color: "游댯" },
        epics: { chance: 5, items: ["Phoenix","Fractal","Cursed","Gravity"], color: "游릮" },
        legendary: { chance: 0.85, items: ["Darkness","Holy"], color: "游리" },
        mythic: { chance: 0.15, items: ["Portal"], color: "游댮" }
      },
      barzil: {
        uncommons: { chance: 60, items: ["Erupting Bricks","Job Application","Pob's Light Snack","Snoob Migration","Falling Boulder","Basketball Explosion","Angry Cat","Evil Cat","Curious Cat","Hello Cat"], color: "游릭" },
        rares: { chance: 34, items: ["Pondering Orb","Clocktower Crash","Oog's Damnation","Portal Mist"], color: "游댯" },
        epics: { chance: 5, items: ["Mortis #1 Fan","Duel of the Ages","Minefield"], color: "游릮" },
        legendary: { chance: 0.85, items: ["Pablo's Clownery","Crunchy Explosion"], color: "游리" },
        mythic: { chance: 0.15, items: ["Barzilian Nexus"], color: "游댮" }
      },
      overkill: {
        epics: { chance: 80, items: ["Vibrant Supernova","Sand Tornado","Rainbomb","Chilling Fog","Aquatic Gateway"], color: "游릮" },
        legendary: { chance: 18.5, items: ["Toxic Puddle","Purple Rapture","Popstar Spectacle"], color: "游리" },
        mythic: { chance: 1.5, items: ["Hellfire Sigil"], color: "游댮" }
      }
    };

    function selectCrate(crate) {
      currentCrate = crate;
      rollCounter = 0;
      document.getElementById("unboxBtn").disabled = false;
      document.getElementById("multiInput").style.display = "inline-block";
      document.getElementById("multiUnboxBtn").style.display = "inline-block";
      document.getElementById("result").innerHTML = `Selected <b>${crate} crate</b>. Press Unbox!`;
    }

    function getRandomItem(crateData) {
      let roll = Math.random() * 100;
      let cumulative = 0;

      if (crateData.uncommons) {
        cumulative += crateData.uncommons.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.uncommons.items), rarity: crateData.uncommons.color, type: "uncommon" };
      }
      if (crateData.rares) {
        cumulative += crateData.rares.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.rares.items), rarity: crateData.rares.color, type: "rare" };
      }
      if (crateData.epics) {
        cumulative += crateData.epics.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.epics.items), rarity: crateData.epics.color, type: "epic" };
      }
      if (crateData.legendary) {
        cumulative += crateData.legendary.chance;
        if (roll <= cumulative) return { item: randomChoice(crateData.legendary.items), rarity: crateData.legendary.color, type: "legendary" };
      }
      if (crateData.mythic) {
        return { item: randomChoice(crateData.mythic.items), rarity: crateData.mythic.color, type: "mythic" };
      }

      return { item: "Unknown", rarity: "", type: "none" };
    }

    function randomChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function unbox() {
      if (!currentCrate || cooldownActive) return;

      rollCounter++;
      const result = getRandomItem(crates[currentCrate]);

      if (result.type === "legendary") {
        document.getElementById("result").innerHTML = `You rolled a legendary after ${rollCounter} rolls: ${result.rarity} <b>${result.item}</b>`;
        rollCounter = 0;
        triggerCooldown(500);
      } else if (result.type === "mythic") {
        document.getElementById("result").innerHTML = `You rolled a mythic after ${rollCounter} rolls: ${result.rarity} <b>${result.item}</b>`;
        rollCounter = 0;
        triggerCooldown(5000);
        document.getElementById("mythicSound").play();
        launchConfetti();
      } else {
        document.getElementById("result").innerHTML = `You unboxed: ${result.rarity} <b>${result.item}</b>`;
      }
    }

    function triggerCooldown(ms) {
      cooldownActive = true;
      document.getElementById("unboxBtn").disabled = true;
      setTimeout(() => {
        cooldownActive = false;
        document.getElementById("unboxBtn").disabled = false;
      }, ms);
    }

    function multiUnbox() {
      const amount = parseInt(document.getElementById("multiInput").value);
      if (!amount || amount <= 0 || !currentCrate) return;

      let results = [];
      for (let i = 0; i < amount; i++) {
        rollCounter++;
        results.push(getRandomItem(crates[currentCrate]));
      }

      const grouped = {};
      results.forEach(r => {
        const key = r.type + "|" + r.rarity + " " + r.item;
        if (!grouped[key]) grouped[key] = 0;
        grouped[key]++;
      });

      const sorted = Object.entries(grouped).sort((a, b) => {
        const rarityA = a[0].split("|")[0];
        const rarityB = b[0].split("|")[0];
        return rarityOrder[rarityA] - rarityOrder[rarityB];
      });

      let log = "";
      sorted.forEach(([key, count]) => {
        const [, name] = key.split("|");
        log += `x${count} ${name}<br>`;
      });

      document.getElementById("logContent").innerHTML = log;
      document.getElementById("popupOverlay").style.display = "flex";
    }

    function closePopup() {
      document.getElementById("popupOverlay").style.display = "none";
    }

    function launchConfetti() {
      const shapes = ["rect", "triangle"];
      for (let i = 0; i < 40; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        const shape = shapes[Math.floor(Math.random() * shapes.length)];
        confetti.style.left = Math.random() * 100 + "vw";
        confetti.style.background = getRandomColor();
        confetti.style.width = (Math.random() * 12 + 8) + "px";
        confetti.style.height = (Math.random() * 20 + 10) + "px";
        if (shape === "triangle") {
          confetti.style.width = 0;
          confetti.style.height = 0;
          confetti.style.borderLeft = "8px solid transparent";
          confetti.style.borderRight = "8px solid transparent";
          confetti.style.borderBottom = "14px solid " + getRandomColor();
          confetti.style.background = "transparent";
        }
        confetti.style.animationDuration = (Math.random() * 1.5 + 2) + "s";
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }
    }

    function getRandomColor() {
      const colors = ["#ff0","#0f0","#0ff","#f0f","#f00","#00f","#ffa500","#39ff14"];
      return colors[Math.floor(Math.random() * colors.length)];
    }
  </script>
</body>
</html>
